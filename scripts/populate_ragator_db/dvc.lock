schema: '2.0'
stages:
  get_all_urls_to_download:
    cmd: PYTHONPATH=. python scripts/populate_ragator_db/stages/get_all_urls_to_download.py
      --max-pages-per-sources 100 --all-urls-to-download-file-path data/ragator/html_urls_to_download.txt
      --params-file-path scripts/populate_ragator_db/params.yaml
    deps:
    - path: scripts/populate_ragator_db/stages/get_all_urls_to_download.py
      hash: md5
      md5: 620c916d2938f3c9367b989efa5c30af
      size: 1303
    params:
      scripts/populate_ragator_db/params.yaml:
        max_pages_per_sources: 100
    outs:
    - path: data/ragator/html_urls_to_download.txt
      hash: md5
      md5: 5fff471f6a751cd316d46c3303b554ac
      size: 12795
  download_html_pages:
    cmd: PYTHONPATH=. python scripts/populate_ragator_db/stages/download_html_pages.py
      --all-urls-to-download-file-path data/ragator/html_urls_to_download.txt --downloaded-html-pages-folder
      data/ragator/downloaded_html_pages
    deps:
    - path: data/ragator/html_urls_to_download.txt
      hash: md5
      md5: 5fff471f6a751cd316d46c3303b554ac
      size: 12795
    - path: scripts/populate_ragator_db/stages/download_html_pages.py
      hash: md5
      md5: 008eeaec937e85a7c4381f2d8fd55cc6
      size: 1030
    outs:
    - path: data/ragator/downloaded_html_pages
      hash: md5
      md5: bdc398492dfe863ffe4d3a22dd36a945.dir
      size: 25665346
      nfiles: 182
  get_chunks_from_html_pages:
    cmd: PYTHONPATH=. python scripts/populate_qdrant_collection/stages/get_chunks_from_html_pages.py
      --downloaded-html-pages-folder data/rag_about_ragator/downloaded_html_pages
      --chunks-parquet-path data/rag_about_ragator/chunks.parquet.gzip
    deps:
    - path: scripts/populate_qdrant_collection/stages/get_chunks_from_html_pages.py
      hash: md5
      md5: aa1c9c81b610a4c5eccac86380e94c2d
      size: 1220
    params:
      scripts/populate_qdrant_collection/params.yaml:
        embedding_model.chunk_overlap: 50
        embedding_model.chunk_size: 500
        embedding_model.name: text-embedding-3-large
        embedding_model.type: openai
    outs:
    - path: data/rag_about_ragator/chunks.parquet.gzip
      hash: md5
      md5: 7c70c4bb4164be191ed74f1e019b6557
      size: 600
  preprocess_html_pages:
    cmd: PYTHONPATH=. python scripts/populate_qdrant_collection/stages/preprocess_html_pages.py
      --downloaded-html-pages-folder data/rag_about_ragator/downloaded_html_pages
      --preprocessed-documents-folder data/rag_about_ragator/preprocessed_documents
    deps:
    - path: scripts/populate_qdrant_collection/stages/preprocess_html_pages.py
      hash: md5
      md5: 79d3292b20e080ee78a31b2c89a30d55
      size: 1034
    outs:
    - path: data/rag_about_ragator/preprocessed_documents
      hash: md5
      md5: a56ba052762f822e52835096652b2675.dir
      size: 9249136
      nfiles: 178
  split_documents_into_chunks:
    cmd: PYTHONPATH=. python scripts/populate_ragator_db/stages/split_documents_into_chunks.py
      --downloaded-html-pages-folder data/ragator/downloaded_html_pages --chunk-size
      1000 --chunk-overlap 200 --chunks-parquet-path data/ragator/chunks.parquet.gzip
    deps:
    - path: data/ragator/downloaded_html_pages
      hash: md5
      md5: bdc398492dfe863ffe4d3a22dd36a945.dir
      size: 25665346
      nfiles: 182
    - path: scripts/populate_ragator_db/stages/split_documents_into_chunks.py
      hash: md5
      md5: 894be9857618915de309afb78688e9c0
      size: 1372
    params:
      scripts/populate_ragator_db/params.yaml:
        splitter.chunk_overlap: 200
        splitter.chunk_size: 1000
    outs:
    - path: data/ragator/chunks.parquet.gzip
      hash: md5
      md5: 88cb47ceaddc01de9072ec2afb88468c
      size: 2845932
  store_chunks_in_db:
    cmd: PYTHONPATH=. python scripts/populate_ragator_db/stages/store_chunks_in_db.py
      --chunks-parquet-path data/ragator/chunks.parquet.gzip --embedding-module src.generation.embeddings.openai
      --embedding-class-name OpenAIEmbeddingModel --embedding-model-name text-embedding-3-small
      --embedding-dimension 1536 --vector-store-module src.retrieval.vector_stores.qdrant
      --vector-store-class-name QdrantStore --vector-store-collection-name ragator-collection
    deps:
    - path: data/ragator/chunks.parquet.gzip
      hash: md5
      md5: 88cb47ceaddc01de9072ec2afb88468c
      size: 2845932
    - path: scripts/populate_ragator_db/stages/store_chunks_in_db.py
      hash: md5
      md5: e8e0c9a4e2091234c26f78c4e8ef27be
      size: 2743
    params:
      scripts/populate_ragator_db/params.yaml:
        embedding.class_name: OpenAIEmbeddingModel
        embedding.dimension: 1536
        embedding.model_name: text-embedding-3-small
        embedding.module: src.generation.embeddings.openai
        vector_store.class_name: QdrantStore
        vector_store.collection_name: ragator-collection
        vector_store.module: src.retrieval.vector_stores.qdrant
