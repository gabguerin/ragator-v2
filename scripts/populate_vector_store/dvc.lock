schema: '2.0'
stages:
  get_all_urls_to_download:
    cmd: PYTHONPATH=. python scripts/populate_vector_store/stages/get_all_urls_to_download.py
      --max-pages-per-sources 100 --all-urls-to-download-file-path data/rag_about_ragator/html_urls_to_download.txt
      --params-file-path scripts/populate_vector_store/params.yaml
    deps:
    - path: scripts/populate_vector_store/stages/get_all_urls_to_download.py
      hash: md5
      md5: e67803fdb088c888c75b7382e675f1d6
      size: 1212
    params:
      scripts/populate_vector_store/params.yaml:
        max_pages_per_sources: 100
    outs:
    - path: data/rag_about_ragator/html_urls_to_download.txt
      hash: md5
      md5: c69cf88e5094f841d45870f23d8fc08f
      size: 12774
  download_html_pages:
    cmd: PYTHONPATH=. python scripts/populate_vector_store/stages/download_html_pages.py
      --all-urls-to-download-file-path data/rag_about_ragator/html_urls_to_download.txt
      --downloaded-html-pages-folder data/rag_about_ragator/downloaded_html_pages
    deps:
    - path: data/rag_about_ragator/html_urls_to_download.txt
      hash: md5
      md5: c69cf88e5094f841d45870f23d8fc08f
      size: 12774
    - path: scripts/populate_vector_store/stages/download_html_pages.py
      hash: md5
      md5: e2158a00b6cfaa8bd9563429c8aba8ab
      size: 969
    outs:
    - path: data/rag_about_ragator/downloaded_html_pages
      hash: md5
      md5: 4f301ea51c1d5ea1c6314972c3b59f87.dir
      size: 32474902
      nfiles: 182
  get_chunks_from_html_pages:
    cmd: PYTHONPATH=. python scripts/populate_qdrant_collection/stages/get_chunks_from_html_pages.py
      --downloaded-html-pages-folder data/rag_about_ragator/downloaded_html_pages
      --chunks-parquet-path data/rag_about_ragator/chunks.parquet.gzip
    deps:
    - path: scripts/populate_qdrant_collection/stages/get_chunks_from_html_pages.py
      hash: md5
      md5: aa1c9c81b610a4c5eccac86380e94c2d
      size: 1220
    params:
      scripts/populate_qdrant_collection/params.yaml:
        embedding_model.chunk_overlap: 50
        embedding_model.chunk_size: 500
        embedding_model.name: text-embedding-3-large
        embedding_model.type: openai
    outs:
    - path: data/rag_about_ragator/chunks.parquet.gzip
      hash: md5
      md5: 7c70c4bb4164be191ed74f1e019b6557
      size: 600
  preprocess_html_pages:
    cmd: PYTHONPATH=. python scripts/populate_qdrant_collection/stages/preprocess_html_pages.py
      --downloaded-html-pages-folder data/rag_about_ragator/downloaded_html_pages
      --preprocessed-documents-folder data/rag_about_ragator/preprocessed_documents
    deps:
    - path: scripts/populate_qdrant_collection/stages/preprocess_html_pages.py
      hash: md5
      md5: 79d3292b20e080ee78a31b2c89a30d55
      size: 1034
    outs:
    - path: data/rag_about_ragator/preprocessed_documents
      hash: md5
      md5: a56ba052762f822e52835096652b2675.dir
      size: 9249136
      nfiles: 178
  split_documents_into_chunks:
    cmd: PYTHONPATH=. python scripts/populate_vector_store/stages/split_documents_into_chunks.py
      --downloaded-html-pages-folder data/rag_about_ragator/downloaded_html_pages
      --chunk-size 1000 --chunk-overlap 200 --chunks-parquet-path data/rag_about_ragator/chunks.parquet.gzip
    deps:
    - path: data/rag_about_ragator/downloaded_html_pages
      hash: md5
      md5: 4f301ea51c1d5ea1c6314972c3b59f87.dir
      size: 32474902
      nfiles: 182
    - path: scripts/populate_vector_store/stages/split_documents_into_chunks.py
      hash: md5
      md5: 275e7f2c7dc60ad89197da6d9e4a7aa0
      size: 1323
    params:
      scripts/populate_vector_store/params.yaml:
        splitter.chunk_overlap: 200
        splitter.chunk_size: 1000
    outs:
    - path: data/rag_about_ragator/chunks.parquet.gzip
      hash: md5
      md5: bcaeccbe9cfb02c5ed3397aa3a8a1428
      size: 5692113
  store_chunks_in_db:
    cmd: PYTHONPATH=. python scripts/populate_vector_store/stages/store_chunks_in_db.py
      --chunks-parquet-path data/rag_about_ragator/chunks.parquet.gzip --embedding-module
      langchain_openai --embedding-class-name OpenAIEmbeddings --embedding-model-name
      text-embedding-3-small --embedding-dimension 1536 --embedding-api-key-env-name
      OPENAI_API_KEY --vector-store-module src.retrieval.vector_stores.qdrant_store
      --vector-store-class-name QdrantStore --vector-store-collection-name ragator-collection
    deps:
    - path: data/rag_about_ragator/chunks.parquet.gzip
      hash: md5
      md5: bcaeccbe9cfb02c5ed3397aa3a8a1428
      size: 5692113
    - path: scripts/populate_vector_store/stages/store_chunks_in_db.py
      hash: md5
      md5: d6067bfd33473ce2938f7a2505841ee6
      size: 2947
    params:
      scripts/populate_vector_store/params.yaml:
        embedding.api_key_env_name: OPENAI_API_KEY
        embedding.class_name: OpenAIEmbeddings
        embedding.dimension: 1536
        embedding.model_name: text-embedding-3-small
        embedding.module: langchain_openai
        vector_store.class_name: QdrantStore
        vector_store.collection_name: ragator-collection
        vector_store.module: src.retrieval.vector_stores.qdrant_store
